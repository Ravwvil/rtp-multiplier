# RTP Multiplier Service
## Математическое обоснование

Цель: получить математическое ожидание RTP равное заданному `rtp`.

$$
\mathbb{E}[\, x \cdot I_{{M > x}} \,] = \mathrm{rtp}
$$

где `M` — множитель, который возвращает сервер, `I_{M > x}` — индикатор события `M > x`.

Вероятность того, что число `x` останется в сумме, должна быть равна `rtp/x`.

Это означает: `P(M > x) = rtp/x`

### Построение распределения множителя M

**Основной принцип:** `P(M > x) = rtp/x` для любого `x ≥ 1`

**Компоненты распределения:**

1. **Точечная масса в M=1**: 
   - Вероятность: `1 - rtp`
   - Смысл: с этой вероятностью M=1, что она обнуляет все числа x ≥ 1

2. **Непрерывная часть для M ∈ (1, 10000]**:
   - **Вывод формулы генерации:**
     - Из условия `P(M > x) = rtp/x` получаем `P(M ≤ x) = 1 - rtp/x`
     - Значит, функция распределения (CDF) `F(m) = 1 - rtp/m`
     - **Метод обратного преобразования:**
       - `u` — равномерно распределенная случайная величина на интервале [0, 1)
       - Для генерации случайной величины с функцией распределения `F(m)` используем формулу: `m = F⁻¹(u)`
       - Находим обратную функцию: если `u = F(m) = 1 - rtp/m`, то решаем уравнение относительно `m`
       - Из `u = 1 - rtp/m` получаем `rtp/m = 1 - u`
       - Следовательно `m = rtp/(1-u)`
   - Генерация: `M = rtp/(1-u)`, где `u ~ U(0,1)`

3. **Точечная масса в M=10000**:
   - Вероятность: `rtp/10000`
   - Смысл: гарантируем, что очень большие множители тоже возможны

### Алгоритм генерации
1. Генерируем случайное число `u` из интервала [0, 1)
2. Если `u < 1 - rtp` → возвращаем `M = 1`
3. Если `u ≥ 1 - rtp/10000` → возвращаем `M = 10000`  
4. Иначе вычисляем `M = rtp/(1-u)` и возвращаем результат

---

## Сборка и запуск


```bash
git clone https://github.com/Ravwvil/rtp-multiplier/
cd rtp-multiplier
# запуск с флагом -rtp:
go run . -rtp=0.5

# или если предыдущая команда не сработала:
go run . -rtp 0.5
